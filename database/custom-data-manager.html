<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Data Manager - Leadership Development</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
            line-height: 1.6;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s;
            font-weight: bold;
        }
        button:hover { 
            background: linear-gradient(135deg, #2980b9, #1f4e79);
            transform: translateY(-2px);
        }
        button:disabled { 
            background: #6c757d; 
            cursor: not-allowed;
            transform: none;
        }
        .btn-success { background: linear-gradient(135deg, #27ae60, #229954); }
        .btn-success:hover { background: linear-gradient(135deg, #229954, #1e8449); }
        .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .btn-warning:hover { background: linear-gradient(135deg, #e67e22, #d35400); }
        .btn-danger { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .btn-danger:hover { background: linear-gradient(135deg, #c0392b, #a93226); }
        
        .log {
            background-color: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
        }
        
        .card h3 {
            color: #2c3e50;
            margin-top: 0;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 10px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        
        .checklist-item input[type="text"] {
            flex: 1;
            margin-right: 10px;
        }
        
        .checklist-item button {
            padding: 6px 12px;
            font-size: 12px;
            margin: 0;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            font-weight: bold;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .preview h4 {
            color: #2c3e50;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Custom Data Manager</h1>
        <p style="text-align: center; color: #6c757d; font-size: 1.1em;">
            Create your own leadership development modules, users, and assignments
        </p>
        
        <div id="status" class="status info">
            Ready to create custom data for your leadership development platform
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('modules')">üìö Modules</button>
            <button class="tab" onclick="showTab('users')">üë• Users</button>
            <button class="tab" onclick="showTab('assignments')">üìã Assignments</button>
            <button class="tab" onclick="showTab('database')">üóÑÔ∏è Database</button>
        </div>
        
        <!-- Modules Tab -->
        <div id="modules-tab" class="tab-content active">
            <h2>üìö Create Leadership Development Modules</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>Module Information</h3>
                    <div class="form-group">
                        <label for="moduleTitle">Module Title *</label>
                        <input type="text" id="moduleTitle" placeholder="e.g., Advanced Communication Strategies">
                    </div>
                    <div class="form-group">
                        <label for="moduleDescription">Description *</label>
                        <textarea id="moduleDescription" placeholder="Describe what this module covers and its learning objectives..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="moduleRole">Required Role *</label>
                        <select id="moduleRole">
                            <option value="Team Member">Team Member</option>
                            <option value="Assistant Supervisor">Assistant Supervisor</option>
                            <option value="Supervisor">Supervisor</option>
                            <option value="Trainer">Trainer</option>
                            <option value="Director">Director</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="moduleDifficulty">Difficulty Level</label>
                        <select id="moduleDifficulty">
                            <option value="Phase 1">Phase 1 - Foundation</option>
                            <option value="Phase 2">Phase 2 - Intermediate</option>
                            <option value="Phase 3">Phase 3 - Advanced</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="moduleDuration">Duration (weeks)</label>
                        <input type="number" id="moduleDuration" value="1" min="1" max="12">
                    </div>
                </div>
                
                <div class="card">
                    <h3>Learning Checklist</h3>
                    <div id="checklistContainer">
                        <div class="checklist-item">
                            <input type="text" placeholder="Learning task or activity">
                            <button type="button" onclick="removeChecklistItem(this)" class="btn-danger">Remove</button>
                        </div>
                    </div>
                    <button type="button" onclick="addChecklistItem()" class="btn-success">+ Add Task</button>
                </div>
                
                <div class="card">
                    <h3>Performance Rubric</h3>
                    <div class="form-group">
                        <label>Quality Performance</label>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; color: #e74c3c;">Unsatisfactory</label>
                            <textarea id="qualityUnsatisfactory" placeholder="e.g., Work contains multiple errors, doesn't meet basic standards, requires significant revision..." style="min-height: 60px;"></textarea>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; color: #f39c12;">Average</label>
                            <textarea id="qualityAverage" placeholder="e.g., Work meets basic requirements, minor errors present, acceptable quality..." style="min-height: 60px;"></textarea>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; color: #27ae60;">Excellent</label>
                            <textarea id="qualityExcellent" placeholder="e.g., Work exceeds expectations, demonstrates mastery, sets high standards..." style="min-height: 60px;"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Speed Performance</label>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; color: #e74c3c;">Unsatisfactory</label>
                            <textarea id="speedUnsatisfactory" placeholder="e.g., Takes significantly longer than expected, misses deadlines, delays team progress..." style="min-height: 60px;"></textarea>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; color: #f39c12;">Average</label>
                            <textarea id="speedAverage" placeholder="e.g., Completes tasks within reasonable time, meets most deadlines..." style="min-height: 60px;"></textarea>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; color: #27ae60;">Excellent</label>
                            <textarea id="speedExcellent" placeholder="e.g., Completes tasks efficiently, often ahead of schedule, helps team stay on track..." style="min-height: 60px;"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Communication Performance</label>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; color: #e74c3c;">Unsatisfactory</label>
                            <textarea id="communicationUnsatisfactory" placeholder="e.g., Unclear messages, poor listening skills, creates confusion..." style="min-height: 60px;"></textarea>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; color: #f39c12;">Average</label>
                            <textarea id="communicationAverage" placeholder="e.g., Clear communication most of the time, occasional misunderstandings..." style="min-height: 60px;"></textarea>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; color: #27ae60;">Excellent</label>
                            <textarea id="communicationExcellent" placeholder="e.g., Crystal clear communication, excellent listening, builds strong relationships..." style="min-height: 60px;"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="preview">
                <h4>üìã Module Preview</h4>
                <div id="modulePreview">Fill in the form above to see a preview of your module</div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="saveModule()" class="btn-success">üíæ Save Module</button>
                <button onclick="clearModuleForm()" class="btn-warning">üóëÔ∏è Clear Form</button>
            </div>
        </div>
        
        <!-- Users Tab -->
        <div id="users-tab" class="tab-content">
            <h2>üë• Create Users</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>User Information</h3>
                    <div class="form-group">
                        <label for="userFullName">Full Name *</label>
                        <input type="text" id="userFullName" placeholder="e.g., John Smith">
                    </div>
                    <div class="form-group">
                        <label for="userUsername">Username *</label>
                        <input type="text" id="userUsername" placeholder="e.g., john.smith">
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email *</label>
                        <input type="email" id="userEmail" placeholder="e.g., john.smith@company.com">
                    </div>
                    <div class="form-group">
                        <label for="userRole">Role *</label>
                        <select id="userRole">
                            <option value="Team Member">Team Member</option>
                            <option value="Assistant Supervisor">Assistant Supervisor</option>
                            <option value="Supervisor">Supervisor</option>
                            <option value="Trainer">Trainer</option>
                            <option value="Director">Director</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="userPassword">Password *</label>
                        <input type="password" id="userPassword" placeholder="Enter a secure password">
                    </div>
                </div>
                
                <div class="card">
                    <h3>User Preview</h3>
                    <div id="userPreview">Fill in the form to see user preview</div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="saveUser()" class="btn-success">üíæ Create User</button>
                <button onclick="clearUserForm()" class="btn-warning">üóëÔ∏è Clear Form</button>
            </div>
        </div>
        
        <!-- Assignments Tab -->
        <div id="assignments-tab" class="tab-content">
            <h2>üìã Create Module Assignments</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>Assignment Details</h3>
                    <div class="form-group">
                        <label for="assignmentUser">Select User *</label>
                        <select id="assignmentUser">
                            <option value="">Loading users...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assignmentModule">Select Module *</label>
                        <select id="assignmentModule">
                            <option value="">Loading modules...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assignmentDueDate">Due Date</label>
                        <input type="date" id="assignmentDueDate">
                    </div>
                    <div class="form-group">
                        <label for="assignmentNotes">Notes</label>
                        <textarea id="assignmentNotes" placeholder="Any special instructions or notes for this assignment..."></textarea>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Assignment Preview</h3>
                    <div id="assignmentPreview">Select a user and module to see assignment preview</div>
                </div>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button onclick="saveAssignment()" class="btn-success">üíæ Create Assignment</button>
                <button onclick="clearAssignmentForm()" class="btn-warning">üóëÔ∏è Clear Form</button>
            </div>
        </div>
        
        <!-- Database Tab -->
        <div id="database-tab" class="tab-content">
            <h2>üóÑÔ∏è Database Management</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>Database Status</h3>
                    <button onclick="checkDatabase()" class="btn-success">üîç Check Database</button>
                    <button onclick="viewData()" class="btn-warning">üìä View All Data</button>
                    <button onclick="clearAllData()" class="btn-danger">üóëÔ∏è Clear All Data</button>
                </div>
                
                <div class="card">
                    <h3>Quick Actions</h3>
                    <button onclick="createSampleData()" class="btn-success">üéØ Create Sample Data</button>
                    <button onclick="exportData()" class="btn-warning">üì§ Export Data</button>
                    <button onclick="importData()" class="btn-warning">üì• Import Data</button>
                </div>
            </div>
        </div>
        
        <div id="log" class="log">
            <div>Welcome to the Custom Data Manager! üéâ</div>
            <div>Use the tabs above to create your own leadership development content.</div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        let currentUsers = [];
        let currentModules = [];
        
        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            // Load data for specific tabs
            if (tabName === 'assignments') {
                loadUsersAndModules();
            }
        }
        
        // Logging functions
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'error': '#e74c3c',
                'success': '#27ae60',
                'warning': '#f39c12',
                'info': '#3498db'
            };
            const color = colors[type] || colors['info'];
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        // Module management
        function addChecklistItem() {
            const container = document.getElementById('checklistContainer');
            const item = document.createElement('div');
            item.className = 'checklist-item';
            item.innerHTML = `
                <input type="text" placeholder="Learning task or activity">
                <button type="button" onclick="removeChecklistItem(this)" class="btn-danger">Remove</button>
            `;
            container.appendChild(item);
            updateModulePreview();
        }
        
        function removeChecklistItem(button) {
            button.parentElement.remove();
            updateModulePreview();
        }
        
        function updateModulePreview() {
            const title = document.getElementById('moduleTitle').value;
            const description = document.getElementById('moduleDescription').value;
            const role = document.getElementById('moduleRole').value;
            const difficulty = document.getElementById('moduleDifficulty').value;
            const duration = document.getElementById('moduleDuration').value;
            
            const checklistItems = Array.from(document.querySelectorAll('#checklistContainer input[type="text"]'))
                .map(input => input.value)
                .filter(value => value.trim() !== '');
            
            // Get performance rubric data
            const qualityUnsatisfactory = document.getElementById('qualityUnsatisfactory').value;
            const qualityAverage = document.getElementById('qualityAverage').value;
            const qualityExcellent = document.getElementById('qualityExcellent').value;
            const speedUnsatisfactory = document.getElementById('speedUnsatisfactory').value;
            const speedAverage = document.getElementById('speedAverage').value;
            const speedExcellent = document.getElementById('speedExcellent').value;
            const communicationUnsatisfactory = document.getElementById('communicationUnsatisfactory').value;
            const communicationAverage = document.getElementById('communicationAverage').value;
            const communicationExcellent = document.getElementById('communicationExcellent').value;
            
            let preview = '';
            if (title) {
                preview += `<h4>${title}</h4>`;
                preview += `<p><strong>Role:</strong> ${role} | <strong>Difficulty:</strong> ${difficulty} | <strong>Duration:</strong> ${duration} week(s)</p>`;
                if (description) {
                    preview += `<p>${description}</p>`;
                }
                if (checklistItems.length > 0) {
                    preview += `<h5>Learning Tasks:</h5><ul>`;
                    checklistItems.forEach(item => {
                        preview += `<li>${item}</li>`;
                    });
                    preview += `</ul>`;
                }
                
                // Add performance rubric preview
                const hasRubric = qualityUnsatisfactory || qualityAverage || qualityExcellent || 
                                 speedUnsatisfactory || speedAverage || speedExcellent ||
                                 communicationUnsatisfactory || communicationAverage || communicationExcellent;
                
                if (hasRubric) {
                    preview += `<h5>Performance Rubric:</h5>`;
                    preview += `<div style="background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 10px 0;">`;
                    
                    if (qualityUnsatisfactory || qualityAverage || qualityExcellent) {
                        preview += `<h6 style="color: #2c3e50; margin-top: 0;">Quality Performance:</h6>`;
                        if (qualityUnsatisfactory) preview += `<p style="color: #e74c3c; margin: 5px 0;"><strong>Unsatisfactory:</strong> ${qualityUnsatisfactory}</p>`;
                        if (qualityAverage) preview += `<p style="color: #f39c12; margin: 5px 0;"><strong>Average:</strong> ${qualityAverage}</p>`;
                        if (qualityExcellent) preview += `<p style="color: #27ae60; margin: 5px 0;"><strong>Excellent:</strong> ${qualityExcellent}</p>`;
                    }
                    
                    if (speedUnsatisfactory || speedAverage || speedExcellent) {
                        preview += `<h6 style="color: #2c3e50;">Speed Performance:</h6>`;
                        if (speedUnsatisfactory) preview += `<p style="color: #e74c3c; margin: 5px 0;"><strong>Unsatisfactory:</strong> ${speedUnsatisfactory}</p>`;
                        if (speedAverage) preview += `<p style="color: #f39c12; margin: 5px 0;"><strong>Average:</strong> ${speedAverage}</p>`;
                        if (speedExcellent) preview += `<p style="color: #27ae60; margin: 5px 0;"><strong>Excellent:</strong> ${speedExcellent}</p>`;
                    }
                    
                    if (communicationUnsatisfactory || communicationAverage || communicationExcellent) {
                        preview += `<h6 style="color: #2c3e50;">Communication Performance:</h6>`;
                        if (communicationUnsatisfactory) preview += `<p style="color: #e74c3c; margin: 5px 0;"><strong>Unsatisfactory:</strong> ${communicationUnsatisfactory}</p>`;
                        if (communicationAverage) preview += `<p style="color: #f39c12; margin: 5px 0;"><strong>Average:</strong> ${communicationAverage}</p>`;
                        if (communicationExcellent) preview += `<p style="color: #27ae60; margin: 5px 0;"><strong>Excellent:</strong> ${communicationExcellent}</p>`;
                    }
                    
                    preview += `</div>`;
                }
            } else {
                preview = 'Fill in the form above to see a preview of your module';
            }
            
            document.getElementById('modulePreview').innerHTML = preview;
        }
        
        // Add event listeners for module form
        document.addEventListener('DOMContentLoaded', function() {
            const moduleFields = [
                'moduleTitle', 'moduleDescription', 'moduleRole', 'moduleDifficulty', 'moduleDuration',
                'qualityUnsatisfactory', 'qualityAverage', 'qualityExcellent',
                'speedUnsatisfactory', 'speedAverage', 'speedExcellent',
                'communicationUnsatisfactory', 'communicationAverage', 'communicationExcellent'
            ];
            
            moduleFields.forEach(id => {
                document.getElementById(id).addEventListener('input', updateModulePreview);
            });
            
            // User form preview
            ['userFullName', 'userUsername', 'userEmail', 'userRole'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateUserPreview);
            });
            
            // Assignment form preview
            ['assignmentUser', 'assignmentModule', 'assignmentDueDate', 'assignmentNotes'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateAssignmentPreview);
            });
        });
        
        async function saveModule() {
            try {
                const title = document.getElementById('moduleTitle').value.trim();
                const description = document.getElementById('moduleDescription').value.trim();
                const role = document.getElementById('moduleRole').value;
                const difficulty = document.getElementById('moduleDifficulty').value;
                const duration = parseInt(document.getElementById('moduleDuration').value);
                
                if (!title || !description) {
                    throw new Error('Please fill in all required fields');
                }
                
                const checklistItems = Array.from(document.querySelectorAll('#checklistContainer input[type="text"]'))
                    .map(input => input.value.trim())
                    .filter(value => value !== '');
                
                // Get performance rubric data
                const qualityUnsatisfactory = document.getElementById('qualityUnsatisfactory').value.trim();
                const qualityAverage = document.getElementById('qualityAverage').value.trim();
                const qualityExcellent = document.getElementById('qualityExcellent').value.trim();
                const speedUnsatisfactory = document.getElementById('speedUnsatisfactory').value.trim();
                const speedAverage = document.getElementById('speedAverage').value.trim();
                const speedExcellent = document.getElementById('speedExcellent').value.trim();
                const communicationUnsatisfactory = document.getElementById('communicationUnsatisfactory').value.trim();
                const communicationAverage = document.getElementById('communicationAverage').value.trim();
                const communicationExcellent = document.getElementById('communicationExcellent').value.trim();
                
                const moduleData = {
                    title: title,
                    description: description,
                    required_role: role,
                    difficulty: difficulty,
                    duration: duration,
                    prerequisites: '',
                    author: 'Custom Created',
                    version: '1.0',
                    tags: `${role.toLowerCase()}, ${difficulty.toLowerCase()}`,
                    quality_unsatisfactory: qualityUnsatisfactory || 'Needs improvement in this area',
                    quality_average: qualityAverage || 'Meets basic expectations',
                    quality_excellent: qualityExcellent || 'Exceeds expectations',
                    speed_unsatisfactory: speedUnsatisfactory || 'Takes longer than expected',
                    speed_average: speedAverage || 'Completes tasks in reasonable time',
                    speed_excellent: speedExcellent || 'Completes tasks efficiently',
                    communication_unsatisfactory: communicationUnsatisfactory || 'Communication needs improvement',
                    communication_average: communicationAverage || 'Clear communication most of the time',
                    communication_excellent: communicationExcellent || 'Excellent communication skills',
                    status: 'active'
                };
                
                log(`Creating module: ${title}...`);
                
                if (!window.dbService || !window.dbService.isConfigured) {
                    throw new Error('Database service not configured');
                }
                
                const result = await window.dbService.apiCall('modules', 'POST', moduleData);
                log(`‚úÖ Successfully created module: ${title}`, 'success');
                
                // Get the module ID from the response
                let moduleId = null;
                if (result && Array.isArray(result) && result.length > 0 && result[0].id) {
                    moduleId = result[0].id;
                } else if (result && result.id) {
                    moduleId = result.id;
                } else {
                    log(`‚ö†Ô∏è Warning: Could not get module ID from response. Checklist items will not be created.`, 'warning');
                }
                
                // Create checklist items if any and we have a valid module ID
                if (checklistItems.length > 0 && moduleId) {
                    try {
                        for (let i = 0; i < checklistItems.length; i++) {
                            const checklistData = {
                                module_id: moduleId,
                                task_text: checklistItems[i],
                                order_index: i + 1
                            };
                            await window.dbService.apiCall('module_checklist', 'POST', checklistData);
                        }
                        log(`‚úÖ Added ${checklistItems.length} checklist items`, 'success');
                    } catch (checklistError) {
                        log(`‚ö†Ô∏è Warning: Could not create checklist items: ${checklistError.message}`, 'warning');
                    }
                } else if (checklistItems.length > 0 && !moduleId) {
                    log(`‚ö†Ô∏è Warning: Could not create checklist items - module ID not available`, 'warning');
                }
                
                updateStatus(`Module "${title}" created successfully!`, 'success');
                clearModuleForm();
                
            } catch (error) {
                log(`‚ùå Failed to create module: ${error.message}`, 'error');
                updateStatus('Failed to create module', 'error');
            }
        }
        
        function clearModuleForm() {
            document.getElementById('moduleTitle').value = '';
            document.getElementById('moduleDescription').value = '';
            document.getElementById('moduleRole').value = 'Team Member';
            document.getElementById('moduleDifficulty').value = 'Phase 1';
            document.getElementById('moduleDuration').value = '1';
            
            // Clear performance rubric fields
            document.getElementById('qualityUnsatisfactory').value = '';
            document.getElementById('qualityAverage').value = '';
            document.getElementById('qualityExcellent').value = '';
            document.getElementById('speedUnsatisfactory').value = '';
            document.getElementById('speedAverage').value = '';
            document.getElementById('speedExcellent').value = '';
            document.getElementById('communicationUnsatisfactory').value = '';
            document.getElementById('communicationAverage').value = '';
            document.getElementById('communicationExcellent').value = '';
            
            const container = document.getElementById('checklistContainer');
            container.innerHTML = `
                <div class="checklist-item">
                    <input type="text" placeholder="Learning task or activity">
                    <button type="button" onclick="removeChecklistItem(this)" class="btn-danger">Remove</button>
                </div>
            `;
            
            updateModulePreview();
        }
        
        // User management
        function updateUserPreview() {
            const fullName = document.getElementById('userFullName').value;
            const username = document.getElementById('userUsername').value;
            const email = document.getElementById('userEmail').value;
            const role = document.getElementById('userRole').value;
            
            let preview = '';
            if (fullName) {
                preview += `<h4>${fullName}</h4>`;
                preview += `<p><strong>Username:</strong> ${username || 'Not set'}</p>`;
                preview += `<p><strong>Email:</strong> ${email || 'Not set'}</p>`;
                preview += `<p><strong>Role:</strong> ${role}</p>`;
            } else {
                preview = 'Fill in the form to see user preview';
            }
            
            document.getElementById('userPreview').innerHTML = preview;
        }
        
        async function saveUser() {
            try {
                const fullName = document.getElementById('userFullName').value.trim();
                const username = document.getElementById('userUsername').value.trim();
                const email = document.getElementById('userEmail').value.trim();
                const role = document.getElementById('userRole').value;
                const password = document.getElementById('userPassword').value;
                
                if (!fullName || !username || !email || !password) {
                    throw new Error('Please fill in all required fields');
                }
                
                const userData = {
                    full_name: fullName,
                    username: username,
                    email: email,
                    role: role,
                    password_hash: btoa(password), // Simple base64 encoding
                    status: 'active'
                };
                
                log(`Creating user: ${fullName}...`);
                
                if (!window.dbService || !window.dbService.isConfigured) {
                    throw new Error('Database service not configured');
                }
                
                const result = await window.dbService.apiCall('users', 'POST', userData);
                log(`‚úÖ Successfully created user: ${fullName}`, 'success');
                
                updateStatus(`User "${fullName}" created successfully!`, 'success');
                clearUserForm();
                
            } catch (error) {
                log(`‚ùå Failed to create user: ${error.message}`, 'error');
                updateStatus('Failed to create user', 'error');
            }
        }
        
        function clearUserForm() {
            document.getElementById('userFullName').value = '';
            document.getElementById('userUsername').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userRole').value = 'Team Member';
            document.getElementById('userPassword').value = '';
            updateUserPreview();
        }
        
        // Assignment management
        async function loadUsersAndModules() {
            try {
                log('Loading users and modules for assignments...');
                
                if (!window.dbService || !window.dbService.isConfigured) {
                    throw new Error('Database service not configured');
                }
                
                const [users, modules] = await Promise.all([
                    window.dbService.apiCall('users?select=*'),
                    window.dbService.apiCall('modules?select=*')
                ]);
                
                currentUsers = users;
                currentModules = modules;
                
                // Populate user dropdown
                const userSelect = document.getElementById('assignmentUser');
                userSelect.innerHTML = '<option value="">Select a user...</option>';
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.full_name} (${user.role})`;
                    userSelect.appendChild(option);
                });
                
                // Populate module dropdown
                const moduleSelect = document.getElementById('assignmentModule');
                moduleSelect.innerHTML = '<option value="">Select a module...</option>';
                modules.forEach(module => {
                    const option = document.createElement('option');
                    option.value = module.id;
                    option.textContent = `${module.title} (${module.required_role})`;
                    moduleSelect.appendChild(option);
                });
                
                log(`‚úÖ Loaded ${users.length} users and ${modules.length} modules`, 'success');
                
            } catch (error) {
                log(`‚ùå Failed to load users and modules: ${error.message}`, 'error');
            }
        }
        
        function updateAssignmentPreview() {
            const userId = document.getElementById('assignmentUser').value;
            const moduleId = document.getElementById('assignmentModule').value;
            const dueDate = document.getElementById('assignmentDueDate').value;
            const notes = document.getElementById('assignmentNotes').value;
            
            let preview = '';
            if (userId && moduleId) {
                const user = currentUsers.find(u => u.id === userId);
                const module = currentModules.find(m => m.id === moduleId);
                
                if (user && module) {
                    preview += `<h4>Assignment Preview</h4>`;
                    preview += `<p><strong>User:</strong> ${user.full_name} (${user.role})</p>`;
                    preview += `<p><strong>Module:</strong> ${module.title}</p>`;
                    if (dueDate) {
                        preview += `<p><strong>Due Date:</strong> ${new Date(dueDate).toLocaleDateString()}</p>`;
                    }
                    if (notes) {
                        preview += `<p><strong>Notes:</strong> ${notes}</p>`;
                    }
                }
            } else {
                preview = 'Select a user and module to see assignment preview';
            }
            
            document.getElementById('assignmentPreview').innerHTML = preview;
        }
        
        async function saveAssignment() {
            try {
                const userId = document.getElementById('assignmentUser').value;
                const moduleId = document.getElementById('assignmentModule').value;
                const dueDate = document.getElementById('assignmentDueDate').value;
                const notes = document.getElementById('assignmentNotes').value.trim();
                
                if (!userId || !moduleId) {
                    throw new Error('Please select both a user and a module');
                }
                
                const assignmentData = {
                    user_id: userId,
                    module_id: moduleId,
                    due_date: dueDate || null,
                    status: 'assigned',
                    notes: notes || null,
                    assigned_by: 'admin' // You might want to get this from current user
                };
                
                const user = currentUsers.find(u => u.id === userId);
                const module = currentModules.find(m => m.id === moduleId);
                
                log(`Creating assignment: ${user.full_name} ‚Üí ${module.title}...`);
                
                if (!window.dbService || !window.dbService.isConfigured) {
                    throw new Error('Database service not configured');
                }
                
                const result = await window.dbService.apiCall('module_assignments', 'POST', assignmentData);
                log(`‚úÖ Successfully created assignment`, 'success');
                
                updateStatus(`Assignment created successfully!`, 'success');
                clearAssignmentForm();
                
            } catch (error) {
                log(`‚ùå Failed to create assignment: ${error.message}`, 'error');
                updateStatus('Failed to create assignment', 'error');
            }
        }
        
        function clearAssignmentForm() {
            document.getElementById('assignmentUser').value = '';
            document.getElementById('assignmentModule').value = '';
            document.getElementById('assignmentDueDate').value = '';
            document.getElementById('assignmentNotes').value = '';
            updateAssignmentPreview();
        }
        
        // Database management
        async function checkDatabase() {
            try {
                updateStatus('Checking database connection...', 'info');
                log('Checking database connection...');
                
                if (!window.dbService || !window.dbService.isConfigured) {
                    throw new Error('Database service not configured');
                }
                
                const [users, modules, assignments] = await Promise.all([
                    window.dbService.apiCall('users?select=count'),
                    window.dbService.apiCall('modules?select=count'),
                    window.dbService.apiCall('module_assignments?select=count')
                ]);
                
                log(`‚úÖ Database connection successful!`, 'success');
                log(`üìä Current data:`, 'info');
                log(`   - Users: ${users.length}`, 'info');
                log(`   - Modules: ${modules.length}`, 'info');
                log(`   - Assignments: ${assignments.length}`, 'info');
                
                updateStatus('Database connected successfully!', 'success');
                
            } catch (error) {
                log(`‚ùå Database check failed: ${error.message}`, 'error');
                updateStatus('Database connection failed', 'error');
            }
        }
        
        async function viewData() {
            try {
                log('Loading all data from database...');
                
                if (!window.dbService || !window.dbService.isConfigured) {
                    throw new Error('Database service not configured');
                }
                
                const [users, modules, assignments] = await Promise.all([
                    window.dbService.apiCall('users?select=*'),
                    window.dbService.apiCall('modules?select=*'),
                    window.dbService.apiCall('module_assignments?select=*')
                ]);
                
                log(`üìä Database Contents:`, 'info');
                log(``, 'info');
                
                log(`üë• USERS (${users.length}):`, 'info');
                users.forEach(user => {
                    log(`   - ${user.full_name} (${user.username}) - ${user.role}`, 'info');
                });
                
                log(``, 'info');
                log(`üìö MODULES (${modules.length}):`, 'info');
                modules.forEach(module => {
                    log(`   - ${module.title} - ${module.required_role} (${module.difficulty})`, 'info');
                });
                
                log(``, 'info');
                log(`üìã ASSIGNMENTS (${assignments.length}):`, 'info');
                assignments.forEach(assignment => {
                    const user = users.find(u => u.id === assignment.user_id);
                    const module = modules.find(m => m.id === assignment.module_id);
                    log(`   - ${user?.full_name || 'Unknown'} ‚Üí ${module?.title || 'Unknown'}`, 'info');
                });
                
            } catch (error) {
                log(`‚ùå Failed to view data: ${error.message}`, 'error');
            }
        }
        
        async function createSampleData() {
            try {
                log('Creating sample leadership development data...');
                
                const sampleModules = [
                    {
                        title: 'Effective Communication',
                        description: 'Master the art of clear, impactful communication in professional settings.',
                        required_role: 'Team Member',
                        difficulty: 'Phase 1',
                        duration: 2
                    },
                    {
                        title: 'Team Leadership Fundamentals',
                        description: 'Learn the core principles of leading and motivating teams.',
                        required_role: 'Supervisor',
                        difficulty: 'Phase 2',
                        duration: 3
                    },
                    {
                        title: 'Strategic Decision Making',
                        description: 'Develop skills for making informed, strategic decisions under pressure.',
                        required_role: 'Director',
                        difficulty: 'Phase 3',
                        duration: 4
                    }
                ];
                
                const sampleUsers = [
                    {
                        full_name: 'Sarah Johnson',
                        username: 'sarah.johnson',
                        email: 'sarah.johnson@company.com',
                        role: 'Team Member',
                        password_hash: btoa('password123')
                    },
                    {
                        full_name: 'Mike Chen',
                        username: 'mike.chen',
                        email: 'mike.chen@company.com',
                        role: 'Supervisor',
                        password_hash: btoa('password123')
                    },
                    {
                        full_name: 'Lisa Rodriguez',
                        username: 'lisa.rodriguez',
                        email: 'lisa.rodriguez@company.com',
                        role: 'Director',
                        password_hash: btoa('password123')
                    }
                ];
                
                // Create modules
                for (const module of sampleModules) {
                    const moduleData = {
                        ...module,
                        prerequisites: '',
                        author: 'Sample Data',
                        version: '1.0',
                        tags: `${module.required_role.toLowerCase()}, ${module.difficulty.toLowerCase()}`,
                        quality_unsatisfactory: 'Needs improvement',
                        quality_average: 'Meets expectations',
                        quality_excellent: 'Exceeds expectations',
                        speed_unsatisfactory: 'Below average pace',
                        speed_average: 'Good pace',
                        speed_excellent: 'Excellent pace',
                        communication_unsatisfactory: 'Communication needs work',
                        communication_average: 'Good communication',
                        communication_excellent: 'Excellent communication',
                        status: 'active'
                    };
                    
                    await window.dbService.apiCall('modules', 'POST', moduleData);
                    log(`‚úÖ Created module: ${module.title}`, 'success');
                }
                
                // Create users
                for (const user of sampleUsers) {
                    const userData = {
                        ...user,
                        status: 'active'
                    };
                    
                    await window.dbService.apiCall('users', 'POST', userData);
                    log(`‚úÖ Created user: ${user.full_name}`, 'success');
                }
                
                log(`üéâ Sample data created successfully!`, 'success');
                updateStatus('Sample data created successfully!', 'success');
                
            } catch (error) {
                log(`‚ùå Failed to create sample data: ${error.message}`, 'error');
                updateStatus('Failed to create sample data', 'error');
            }
        }
        
        async function clearAllData() {
            if (!confirm('Are you sure you want to clear ALL data? This cannot be undone!')) {
                return;
            }
            
            try {
                log('Clearing all data from database...', 'warning');
                
                if (!window.dbService || !window.dbService.isConfigured) {
                    throw new Error('Database service not configured');
                }
                
                // Delete in reverse order of dependencies
                await window.dbService.apiCall('module_assignments', 'DELETE');
                await window.dbService.apiCall('module_checklist', 'DELETE');
                await window.dbService.apiCall('modules', 'DELETE');
                await window.dbService.apiCall('users', 'DELETE');
                
                log(`‚úÖ All data cleared successfully`, 'success');
                updateStatus('All data cleared successfully', 'success');
                
            } catch (error) {
                log(`‚ùå Failed to clear data: ${error.message}`, 'error');
                updateStatus('Failed to clear data', 'error');
            }
        }
        
        function exportData() {
            log('Export functionality coming soon!', 'info');
        }
        
        function importData() {
            log('Import functionality coming soon!', 'info');
        }
        
        // Initialize
        window.addEventListener('load', () => {
            log('Custom Data Manager loaded successfully! üéâ', 'success');
            log('Use the tabs above to create your leadership development content.', 'info');
            checkDatabase();
        });
    </script>
</body>
</html>
